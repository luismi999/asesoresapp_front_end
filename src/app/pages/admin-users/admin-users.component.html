<!-- Pantalla de carga  -->
<app-loading *ngIf="flag_loading"></app-loading>

<!-- Notificación -->
<p-toast key="serverResponse" position="bottom-center" [breakpoints]="{'920px': {width: '90%', right: '5', left: '5'}}">></p-toast>

<!-- Tabla de usuarios  -->
<div class="row my-4">
    <div class="col-12">
        <!-- Titulo  -->
        <h6 class="text-muted">
            <!-- Icono -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 18">
                <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
            </svg>
            Administrar usuarios
        </h6>
        <!-- Linea horizontal  -->
        <hr>
        <!-- Card  -->
        <div class="card shadow">
            <div class="d-flex card-header justify-content-between align-items-center">
                <!-- Buscador de usuario por código institucional  -->
                <div class="form-floating">
                    <input type="text" class="form-control" id="code" (change)="getUserByInstitutionalCode($event)">
                    <label for="code">Código institucional</label>
                </div>
                <!-- Selector  -->
                <div class="form-floating" style="width: 200px">
                    <select class="form-select cursor-pointer" aria-label="Floating label select example" (change)="getUsersBySelected($event)">
                        <option class="" value="advisor" selected>Asesores</option>
                        <option class="" value="student">Estudiantes</option>
                        <option class="" value="admin">Administradores</option>
                    </select>
                    <label for="floatingSelect" class="">Filtrar por role</label>
                </div> 
            </div>
            <!-- Tabla  -->
            <div class="card-body pt-0">
                <div class="table-responsive table-responsive-height">
                    <table *ngIf="users?.length != 0" class="table table-centered table-nowrap table-hover mb-0">
                        <!-- Cabecera de tabla -->
                        <thead>
                            <tr>
                                <!-- Imagen -->
                                <th scope="col"></th>
                                <!-- Fecha de creación -->
                                <th scope="col">
                                    <!-- Icono -->
                                    <span class="text-warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-badge-fill" viewBox="0 0 16 18">
                                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm4.5 0a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zM8 11a3 3 0 1 0 0-6 3 3 0 0 0 0 6m5 2.755C12.146 12.825 10.623 12 8 12s-4.146.826-5 1.755V14a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1z"/>
                                        </svg>
                                    </span>
                                    Código
                                </th>
                                <!-- Usuario -->
                                <th scope="col">
                                    <!-- Icono -->
                                    <span class="text-warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 18">
                                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                                        </svg>
                                    </span>
                                    Usuario
                                </th>
                                <!-- Role -->
                                <th scope="col">
                                    <!-- Icono -->
                                    <span class="text-warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-controller" viewBox="0 0 16 18">
                                            <path d="M11.5 6.027a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m-1.5 1.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1m2.5-.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m-1.5 1.5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1m-6.5-3h1v1h1v1h-1v1h-1v-1h-1v-1h1z"/>
                                            <path d="M3.051 3.26a.5.5 0 0 1 .354-.613l1.932-.518a.5.5 0 0 1 .62.39c.655-.079 1.35-.117 2.043-.117.72 0 1.443.041 2.12.126a.5.5 0 0 1 .622-.399l1.932.518a.5.5 0 0 1 .306.729q.211.136.373.297c.408.408.78 1.05 1.095 1.772.32.733.599 1.591.805 2.466s.34 1.78.364 2.606c.024.816-.059 1.602-.328 2.21a1.42 1.42 0 0 1-1.445.83c-.636-.067-1.115-.394-1.513-.773-.245-.232-.496-.526-.739-.808-.126-.148-.25-.292-.368-.423-.728-.804-1.597-1.527-3.224-1.527s-2.496.723-3.224 1.527c-.119.131-.242.275-.368.423-.243.282-.494.575-.739.808-.398.38-.877.706-1.513.773a1.42 1.42 0 0 1-1.445-.83c-.27-.608-.352-1.395-.329-2.21.024-.826.16-1.73.365-2.606.206-.875.486-1.733.805-2.466.315-.722.687-1.364 1.094-1.772a2.3 2.3 0 0 1 .433-.335l-.028-.079zm2.036.412c-.877.185-1.469.443-1.733.708-.276.276-.587.783-.885 1.465a14 14 0 0 0-.748 2.295 12.4 12.4 0 0 0-.339 2.406c-.022.755.062 1.368.243 1.776a.42.42 0 0 0 .426.24c.327-.034.61-.199.929-.502.212-.202.4-.423.615-.674.133-.156.276-.323.44-.504C4.861 9.969 5.978 9.027 8 9.027s3.139.942 3.965 1.855c.164.181.307.348.44.504.214.251.403.472.615.674.318.303.601.468.929.503a.42.42 0 0 0 .426-.241c.18-.408.265-1.02.243-1.776a12.4 12.4 0 0 0-.339-2.406 14 14 0 0 0-.748-2.295c-.298-.682-.61-1.19-.885-1.465-.264-.265-.856-.523-1.733-.708-.85-.179-1.877-.27-2.913-.27s-2.063.091-2.913.27"/>
                                        </svg>
                                    </span>
                                    Role
                                </th>
                                <!-- Estado -->
                                <th scope="col">
                                    <!-- Icono -->
                                    <span class="text-warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-flag-fill" viewBox="0 0 16 18">
                                            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001"/>
                                        </svg>
                                    </span>
                                    Activo
                                </th>
                                <!-- Botón -->
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <!-- Cuerpo de la tabla -->
                        <tbody>
                            <tr *ngFor="let user of users">
                                <!-- imagen del cuadrado negro-->
                                <td class="">
                                    <figure class="my-1" style="width: 50px; height: 50px; border-radius: 100%; margin-bottom: 0px; background-image: url(../../../assets/images/logo_user.png); background-repeat: no-repeat; background-size: cover;"></figure>
                                </td>
                                <!-- Código -->
                                <td>
                                    <p class="text-muted my-3">{{user.institutional_code}}</p>
                                </td>
                                <!-- Estudiante -->
                                <td>
                                    <p class="text-muted my-3">{{user.first_name | titlecase}} {{user.last_name | titlecase}}</p>
                                </td>
                                <!-- Administrar role -->
                                <td>
                                    <form [formGroup]="form1">
                                        <select class="form-select cursor-pointer" style="width: 150px; height: 50px;" aria-label="Default select example" formControlName="role" (change)="updateRole(user)">
                                            <option [value]="user.role" value="student">{{user.role | uppercase}}</option>
                                            <option *ngIf="user.role != 'student'" value="student">STUDENT</option>
                                            <option *ngIf="user.role != 'advisor'" value="advisor">ADVISOR</option>
                                            <option *ngIf="user.role != 'admin'" value="admin">ADMIN</option>
                                        </select>
                                    </form>
                                </td>
                                <!-- Administrar IsActive-->
                                <td>
                                    <div class="form-check form-switch my-3">
                                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" [checked]="user.isActive" (change)="updateIsActive(user, $event)">
                                        <label class="form-check-label" for="flexSwitchCheckChecked">Activo</label>
                                    </div>
                                </td>
                                <td>
                                    <div class="dropdown my-2 float-end">
                                        <a class="btn btn-secondary dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <!-- Icono de detalles  -->
                                            <span class="text-light">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-list-details" width="20" height="20" viewBox="0 0 30 30" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M13 5h8" />
                                                    <path d="M13 9h5" />
                                                    <path d="M13 15h8" />
                                                    <path d="M13 19h5" />
                                                    <path d="M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                                                    <path d="M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />
                                                </svg>
                                            </span>
                                            Detalles
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-dark">
                                            <!-- Ver al usuario  -->
                                            <li>
                                                <a class="dropdown-item cursor-pointer" (click)="showModalViewUser(user)">
                                                    <h6 class="mt-2">
                                                        <!-- Icono de ojo  -->
                                                        <span class="text-light">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 18">
                                                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                                                            </svg>
                                                        </span>
                                                        Usuario
                                                    </h6>
                                                </a>
                                            </li>
                                            <!-- Divisor  -->
                                            <li><hr class="dropdown-divider"></li>
                                            <li>
                                                <a class="dropdown-item cursor-pointer" (click)="showConfirmation(user)">    
                                                    <h6 class="mt-2">
                                                        <!-- Icono de ojo  -->
                                                        <span class="text-light">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash-x-filled" width="20" height="20" viewBox="0 0 30 30" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                                <path d="M20 6a1 1 0 0 1 .117 1.993l-.117 .007h-.081l-.919 11a3 3 0 0 1 -2.824 2.995l-.176 .005h-8c-1.598 0 -2.904 -1.249 -2.992 -2.75l-.005 -.167l-.923 -11.083h-.08a1 1 0 0 1 -.117 -1.993l.117 -.007h16zm-9.489 5.14a1 1 0 0 0 -1.218 1.567l1.292 1.293l-1.292 1.293l-.083 .094a1 1 0 0 0 1.497 1.32l1.293 -1.292l1.293 1.292l.094 .083a1 1 0 0 0 1.32 -1.497l-1.292 -1.293l1.292 -1.293l.083 -.094a1 1 0 0 0 -1.497 -1.32l-1.293 1.292l-1.293 -1.292l-.094 -.083z" stroke-width="0" fill="currentColor" />
                                                                <path d="M14 2a2 2 0 0 1 2 2a1 1 0 0 1 -1.993 .117l-.007 -.117h-4l-.007 .117a1 1 0 0 1 -1.993 -.117a2 2 0 0 1 1.85 -1.995l.15 -.005h4z" stroke-width="0" fill="currentColor" />
                                                            </svg>
                                                        </span>
                                                        Eliminar
                                                    </h6>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- No hay registros  -->
                    <h6 *ngIf="users?.length == 0" class="text-center text-table-font" style="margin-top: 260px;">
                        <p>
                            No hay registros
                        </p>
                    </h6>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gráfica de usuarios  -->
<app-chart-users></app-chart-users>

<!-- Instrucciones -->
<div class="row mt-3">
    <div class="col">
        <!-- Card -->
        <div class="card shadow">
            <!-- Card-header -->
            <div class="card-header">
                <!-- Titulo -->
                <h6 class="text-center">
                    <!-- Icono -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book" viewBox="0 0 16 18">
                        <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"/>
                    </svg>
                    Descripción del componente
                </h6>
            </div>
            <!-- Card body -->
            <div class="card-body">
                <!-- Descripción -->
                <p>
                    El componente ADMINISTRAR USUARIOS en AsesoresApp es una herramienta clave para los administradores, 
                    brindándoles un control total sobre la gestión de usuarios en la plataforma. Con la capacidad de 
                    visualizar a todos los usuarios registrados, los administradores pueden cambiar el estado de las cuentas 
                    entre "Activo" e "Inactivo". Además, tienen el poder de asignar roles personalizables, como "Estudiante", 
                    "Asesor" o "Administrador", adaptando los niveles de acceso y responsabilidades según sea necesario. Este 
                    componente proporciona una gestión eficiente y centralizada de usuarios, ofreciendo un control preciso 
                    sobre el acceso y las funciones dentro de la aplicación.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Modal para ver un usuario  -->
<app-view-user-advisor [flag]="flag_show_view_user" [user_who_wants_to_see]="my_user" (flag_response)="flag_show_view_user = $event"></app-view-user-advisor>

<!-- Confirmación de eliminación de asesoría  -->
<p-confirmDialog [style]="{width: '30vw'}" [breakpoints]="{'960px': '75vw', '640px': '95vw'}"></p-confirmDialog>