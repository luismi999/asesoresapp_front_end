<!-- Pantalla de carga  -->
<app-loading *ngIf="flag_loading"></app-loading>

<!-- Notificación -->
<p-toast key="serverResponse" position="bottom-center" [breakpoints]="{'920px': {width: '90%', right: '5', left: '5'}}">></p-toast>

<div class="row">
    <div class="col">
        <!-- Titulo  -->
        <h6 class="">
            <!-- Icono -->
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 18">
                <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
            </svg>
            Administrar usuarios
        </h6>
    </div>
</div>

<div class="row">
    <div class="col">
        <!-- Linea horizontal -->
         <hr>
    </div>
</div>

<div class="row">
    <div class="col">
        <div class="card shadow">
            <div class="card-header">
                <!-- Selector  -->
                <div class="form-floating select-size float-start">
                    <select class="form-select cursor-pointer" aria-label="Floating label select example" (change)="getUsersBySelected($event)">
                        <option class="" value="advisor" selected>Asesores</option>
                        <option class="" value="student">Estudiantes</option>
                        <option class="" value="admin">Administradores</option>
                    </select>
                    <label for="floatingSelect" class="">Filtrar por role</label>
                </div> 
                <!-- Buscador de usuario por código institucional  -->
                <div class="form-floating float-end" style="width: 150px;" >
                    <input type="text" class="form-control" id="code" (change)="getUserByInstitutionalCode($event)">
                    <label for="code">Código institucional</label>
                </div>
            </div>
            <div *ngIf="users?.length != 0" class="card-body card-body-height table-responsive table-responsive-height">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th scope="col"><p>Código institucional</p></th>
                            <th scope="col"><p>Nombre(s)</p></th>
                            <th scope="col"><p>Apellido(s)</p></th>
                            <th scope="col"><p>Acceso</p></th>
                            <th scope="col"><p>Rol</p></th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of users">
                            <td><p class="my-3">{{user.institutional_code}}</p></td>
                            <td><p class="my-3">{{user.first_name | titlecase}}</p></td>
                            <td><p class="my-3">{{user.last_name | titlecase}}</p></td>
                            <td>
                                <div *ngIf="user.uuid != my_user?.uuid" class="form-check form-switch my-3">
                                    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" [checked]="user.isActive" (change)="updateIsActive(user, $event)">
                                    <label class="form-check-label" for="flexSwitchCheckChecked">Permitido</label>
                                </div>
                                <!-- No permitido para el admin de turno  -->
                                <p *ngIf="user.uuid == my_user?.uuid" class="my-3">No permitido</p>
                            </td>
                            <td>
                                <form *ngIf="user.uuid != my_user?.uuid" [formGroup]="form1">
                                    <select class="form-select cursor-pointer select-size" aria-label="Default select example" formControlName="role" (change)="updateRole(user)">
                                        <option [value]="user.role" value="student">{{user.role | uppercase}}</option>
                                        <option *ngIf="user.role != 'student'" value="student">STUDENT</option>
                                        <option *ngIf="user.role != 'advisor'" value="advisor">ADVISOR</option>
                                        <option *ngIf="user.role != 'admin'" value="admin">ADMIN</option>
                                    </select>
                                </form>
                                <!-- No permitido para el admin de turno  -->
                                <p *ngIf="user.uuid == my_user?.uuid" class="my-3">No permitido</p>
                            </td>
                            <td>
                                <div class="dropdown my-2 float-end">
                                    <a class="btn btn-dark dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">Investigar</a>
                                    <ul class="dropdown-menu dropdown-menu-dark">
                                        <!-- Ver al usuario  -->
                                        <li><a class="dropdown-item cursor-pointer" (click)="showModalViewUser(user)">Detalles</a></li>
                                        <!-- Divisor  -->
                                        <li *ngIf="user.uuid != my_user?.uuid"><hr class="dropdown-divider"></li>
                                        <li *ngIf="user.uuid != my_user?.uuid"><a class="dropdown-item cursor-pointer" (click)="showConfirmation(user)">Eliminar</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div *ngIf="users?.length == 0" class="card-body card-body-height table-responsive table-responsive-height">
                <h6 class="text-center text-table-font">
                    <p>No hay registros</p>
                </h6>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col">
        <!-- Linea horizontal -->
        <hr>
    </div>
</div>

<!-- ------------------------------------------------------------------------------ Update ------------------------------------------------------------------------------->

<!-- Gráfica de usuarios  -->
<app-chart-users></app-chart-users>

<!-- Modal para ver un usuario asesor -->
<app-view-user-advisor [flag]="flag_show_view_user_advisor" [user_who_wants_to_see]="my_user" (flag_response)="flag_show_view_user_advisor = $event"></app-view-user-advisor>

<!-- Modal para ver un usuario  -->
<app-view-user-student [flag]="flag_show_view_user_student" [user_who_wants_to_see]="my_user" (flag_response)="flag_show_view_user_student = $event"></app-view-user-student>

<!-- Confirmación de eliminación de asesoría  -->
<p-confirmDialog [style]="{width: '30vw'}" [breakpoints]="{'960px': '75vw', '640px': '95vw'}"></p-confirmDialog>